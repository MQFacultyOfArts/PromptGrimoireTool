# PromptGrimoire Environment Configuration
# Copy to .env and fill in your values
#
# Variable naming: double-underscore (__) separates config group from field.
# e.g. STYTCH__PROJECT_ID -> Settings.stytch.project_id

# =============================================================================
# Stytch B2B Authentication (STYTCH__)
# Get these from https://stytch.com/dashboard -> API Keys
# =============================================================================

# Project credentials (use test keys for development)
STYTCH__PROJECT_ID=project-test-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# Stytch secret API key
STYTCH__SECRET=secret-test-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Public token (for SSO redirects, found in Dashboard -> API Keys)
STYTCH__PUBLIC_TOKEN=public-token-test-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# Default Organization ID (create in Dashboard -> Organizations)
STYTCH__DEFAULT_ORG_ID=organization-test-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# SSO Connection ID for AAF (create in Dashboard -> SSO -> OIDC)
# Only needed if using AAF SSO; requires STYTCH__PUBLIC_TOKEN
# Format: oidc-connection-test-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
STYTCH__SSO_CONNECTION_ID=

# =============================================================================
# Database (DATABASE__)
# Optional â€” app works without it
# =============================================================================

# PostgreSQL connection string (async driver)
# Required for: /annotation workspace persistence, /courses
# Not used by: /roleplay, /logs, demo pages
#
# Uncomment ONE of the following options:

# Option 1: Local Unix socket (no password needed if pg_hba.conf uses "peer" auth)
# DATABASE__URL=postgresql+asyncpg://your_username@/promptgrimoire?host=/var/run/postgresql

# Option 2: TCP connection with password
# DATABASE__URL=postgresql+asyncpg://user:password@localhost:5432/promptgrimoire

# =============================================================================
# Claude API / LLM (LLM__)
# =============================================================================

# Anthropic API key for Claude
LLM__API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Claude model to use (default: claude-sonnet-4-20250514)
LLM__MODEL=claude-sonnet-4-20250514

# Extended thinking token budget (default: 1024, set to 0 to disable)
LLM__THINKING_BUDGET=1024

# Max tokens for lorebook entries (default: 0 = unlimited)
LLM__LOREBOOK_TOKEN_BUDGET=0

# =============================================================================
# Application Settings (APP__)
# =============================================================================

# Base URL for your application (used in magic link callbacks)
APP__BASE_URL=http://localhost:8080

# Port to run the application on
APP__PORT=8080

# Secret for encrypting NiceGUI session storage
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
# or: openssl rand 64 | openssl enc -A -base64
APP__STORAGE_SECRET=change-me-generate-a-real-secret

# Directory for JSONL roleplay session logs (default: logs/sessions)
APP__LOG_DIR=logs/sessions

# Path to latexmk executable for PDF export
# Leave empty to use TinyTeX at ~/.TinyTeX/bin/x86_64-linux/latexmk
# Run `uv run python scripts/setup_latex.py` to install TinyTeX
APP__LATEXMK_PATH=

# =============================================================================
# Feature Flags (FEATURES__)
# =============================================================================

# Enable roleplay page and session log viewer (default: true)
# Set to "false" to hide /roleplay and /logs from navigation
FEATURES__ENABLE_ROLEPLAY=true

# Enable file upload in annotation content form (default: true)
# Set to "false" to show only the text/paste area, hiding the upload widget
FEATURES__ENABLE_FILE_UPLOAD=true

# =============================================================================
# Internationalisation (I18N__)
# =============================================================================

# Label for the academic grouping concept (default: "Unit")
# Australian universities use "Unit"; set to "Course" for other conventions.
I18N__UNIT_LABEL=Unit

# =============================================================================
# Dev / Testing (DEV__)
# =============================================================================

# Set to "true" to use MockAuthClient instead of real Stytch
# Useful for development and testing without Stytch credentials
DEV__AUTH_MOCK=false

# Enable demo pages in navigation (text-selection, crdt-sync, live-annotation)
# Set to "true" in development, disable in production
DEV__ENABLE_DEMO_PAGES=false

# Enable SQL query logging (useful for debugging)
DEV__DATABASE_ECHO=false

# Per-worktree database isolation (default: true)
# When enabled, database URLs on feature branches are automatically suffixed
# with a sanitised branch name (e.g. promptgrimoire_130_pydantic_settings)
# to prevent migration conflicts between worktrees.
# Set to "false" to use the base database name on all branches.
DEV__BRANCH_DB_SUFFIX=true

# =============================================================================
# Test Database (DEV__)
# Required for running tests
# =============================================================================

# IMPORTANT: Use a SEPARATE database for tests, not your development database!
# Tests use this to set DATABASE__URL automatically for isolation.
#
# The test suite:
# - CLI pre-test cleanup reads DEV__TEST_DATABASE_URL (never DATABASE__URL)
# - Runs Alembic migrations and truncates tables before pytest starts
# - Sets DATABASE__URL from DEV__TEST_DATABASE_URL at test session start
# - Uses UUID-based isolation (tests don't interfere with each other)
#
# DEV__TEST_DATABASE_URL=postgresql+asyncpg://your_username@/promptgrimoire_test?host=/var/run/postgresql

# E2E test server base URL (set automatically by `uv run test-e2e`)
# When set, the app_server pytest fixture skips starting its own server
# and uses this URL directly. All xdist workers share the one server.
# E2E_BASE_URL=http://localhost:8080
