# Human Test Plan: Empty-Tag Annotation UX (#210)

## Prerequisites

- App running locally (`uv run python -m promptgrimoire`)
- `uv run test-e2e -k test_empty_tag` passing (all subtests green)
- Dev data seeded (`uv run seed-data`)
- Two accounts available: one privileged user (instructor or org admin), one student enrolled in an activity with `allow_tag_creation=False` and no seeded tags

---

## Phase 1: Floating Menu Behaviour

### Step Group 1 — "+ New" button in zero-tag workspace (AC1.1)

| Step | Action | Expected |
|------|--------|----------|
| 1 | Log in as the privileged user. Navigate to a workspace with no tags. | Annotation page loads with the document visible |
| 2 | Click and drag to select approximately 10-15 characters of body text | Floating highlight menu appears near the selection |
| 3 | Inspect the floating menu | A button labelled "+ New" is visible |
| 4 | Inspect the floating menu for the fallback message | The text "No tags available" is absent |

### Step Group 2 — Cancel dialog: no highlight created, re-select works (AC1.5)

| Step | Action | Expected |
|------|--------|----------|
| 1 | In the same zero-tag workspace, select 10-15 characters | Floating menu appears with "+ New" |
| 2 | Click "+ New" | Quick-create dialog opens |
| 3 | Click "Cancel" in the dialog | Dialog closes without saving |
| 4 | Inspect the sidebar annotation panel | Zero annotation cards are present |
| 5 | Click and drag to select a different span of text | Floating menu reappears with the "+ New" button still present |

### Step Group 3 — Create tag and apply highlight in one action (AC1.2)

| Step | Action | Expected |
|------|--------|----------|
| 1 | In a zero-tag workspace, select 10-15 characters | Floating menu appears with "+ New" |
| 2 | Click "+ New" | Quick-create dialog opens |
| 3 | Type a tag name (e.g. "Concept") in the name input field | Name field accepts input |
| 4 | Click "Create" | Dialog closes; the selected text is highlighted in the document; an annotation card appears in the sidebar |

### Step Group 4 — "+ New" appears alongside existing tag buttons (AC1.3)

| Step | Action | Expected |
|------|--------|----------|
| 1 | In the workspace from Step Group 3 (now has one tag), click elsewhere to clear selection | No menu visible |
| 2 | Select a different span of text | Floating menu appears |
| 3 | Inspect the floating menu | At least one tag button (for "Concept") is visible AND the "+ New" button is also present |

### Step Group 5 — "No tags available" for student without permission (AC1.4)

| Step | Action | Expected |
|------|--------|----------|
| 1 | Log in as the student account. Navigate to the activity workspace that has no tags and `allow_tag_creation=False`. | Annotation page loads |
| 2 | Select 10-15 characters of body text | Floating menu appears |
| 3 | Inspect the floating menu | "No tags available" is visible; no "+ New" button is present |
| 4 | Hover over the "No tags available" text for 1-2 seconds | Tooltip appears containing "Ask your instructor to add tags to this activity" |

---

## Phase 2: Toolbar Button Label Expansion

### Step Group 6 — Expanded labels with 0 tags (AC2.1, AC2.2)

| Step | Action | Expected |
|------|--------|----------|
| 1 | Log in as the privileged user. Open a workspace with 0 tags. | Annotation page loads; tag toolbar visible at the top of the tag panel |
| 2 | Inspect the create button (left of the two action buttons) | Button shows both an icon and the text "Create New Tag" |
| 3 | Inspect the manage button (gear icon) | Button shows both an icon and the text "Manage Tags" |

### Step Group 7 — Compact icon-only with 5+ tags (AC2.3)

| Step | Action | Expected |
|------|--------|----------|
| 1 | Open a workspace that has 5 or more tags | Tag toolbar shows multiple coloured tag buttons |
| 2 | Inspect the create button | Only an icon is visible; the text "Create New Tag" is absent |
| 3 | Inspect the manage button | Only an icon is visible; the text "Manage Tags" is absent |

### Step Group 8 — Live transition from expanded to compact on 5th tag (AC2.4)

| Step | Action | Expected |
|------|--------|----------|
| 1 | Open a workspace with exactly 4 tags | Toolbar shows expanded text labels on both action buttons |
| 2 | Click the "Create New Tag" button | Quick-create dialog opens |
| 3 | Enter "FifthTag" and click "Create" | Dialog closes; new tag appears in the toolbar |
| 4 | Without reloading the page, observe the two action buttons | Both buttons have switched to icon-only — "Create New Tag" and "Manage Tags" text labels have disappeared |

---

## Phase 3: Tooltips at All Tag Counts

### Step Group 9 — Floating menu "+ New" tooltip (AC3.1)

| Step | Action | Expected |
|------|--------|----------|
| 1 | In a zero-tag workspace, select text to trigger the floating menu | "+ New" button is visible |
| 2 | Hover over the "+ New" button for 1-2 seconds | Tooltip appears with text "Create a new tag and apply it to your selection" |

### Step Group 10 — Toolbar tooltips at 0 tags (AC3.2, AC3.3, AC3.4)

| Step | Action | Expected |
|------|--------|----------|
| 1 | In a zero-tag workspace, hover over the create button for 1-2 seconds | Tooltip text: "Create a new tag for highlighting and annotating text" |
| 2 | Move the mouse away to dismiss the tooltip, then hover over the manage button | Tooltip text: "Manage tags -- create, edit, reorder, and import tags" |

### Step Group 11 — Toolbar tooltips at 5+ tags (AC3.4)

| Step | Action | Expected |
|------|--------|----------|
| 1 | In a workspace with 5+ tags (compact button mode), hover over the create button | Tooltip still appears: "Create a new tag for highlighting and annotating text" |
| 2 | Move the mouse away, then hover over the manage button | Tooltip still appears: "Manage tags -- create, edit, reorder, and import tags" |

---

## End-to-End: First-Time Instructor

Purpose: Validate that an instructor arriving at an empty workspace can complete the full tag creation workflow without prior guidance.

| Step | Action | Expected |
|------|--------|----------|
| 1 | Log in as instructor, navigate to a fresh workspace with 0 tags | Toolbar shows "Create New Tag" and "Manage Tags" with labels |
| 2 | Hover the create button | Tooltip explains purpose clearly |
| 3 | Hover the manage button | Tooltip explains full scope |
| 4 | Select a passage of text | Floating menu shows "+ New" — not a dead end |
| 5 | Hover "+ New" | Tooltip says "Create a new tag and apply it to your selection" |
| 6 | Click "+ New", enter name "Theme A", click Create | Tag created; highlight applied to selected text |
| 7 | Repeat the create flow 3 more times (Tags B, C, D) | After each creation, toolbar still shows expanded labels |
| 8 | Create a 5th tag ("Tag E") | Toolbar switches to compact icon-only buttons |
| 9 | Hover both toolbar buttons in their compact state | Tooltips still display with correct text |

## End-to-End: Student Dead-End Scenario

Purpose: Validate that a student in a zero-tag activity receives a clear, non-confusing message.

| Step | Action | Expected |
|------|--------|----------|
| 1 | Log in as a student in an activity with `allow_tag_creation=False` and no tags | Annotation page loads |
| 2 | Select any text | Floating menu appears |
| 3 | Inspect the menu | "No tags available" is shown; no "+ New" button |
| 4 | Hover "No tags available" | Tooltip says "Ask your instructor to add tags to this activity" |

---

## Traceability

| Acceptance Criterion | Automated Test | Manual Step Group |
|----------------------|----------------|-------------------|
| AC1.1 — "+ New" in zero-tag workspace | `ac1_1_new_button_in_zero_tag_workspace` | Step Group 1 |
| AC1.2 — "+ New" creates tag and highlight | `ac1_2_new_button_creates_highlight` | Step Group 3 |
| AC1.3 — "+ New" alongside existing tags | `ac1_3_new_button_alongside_tags` | Step Group 4 |
| AC1.4 — "No tags available" without permission | `ac1_4_no_permission_dead_end` | Step Group 5 |
| AC1.5 — Cancel: no highlight; re-select works | `ac1_5_cancel` + `ac1_5_reselect` | Step Group 2 |
| AC2.1 — Expanded "Create New Tag" at 0-4 tags | `ac2_1_create_button_shows_text` | Step Group 6 |
| AC2.2 — Expanded "Manage Tags" at 0-4 tags | `ac2_2_manage_button_shows_text` | Step Group 6 |
| AC2.3 — Compact icon-only at 5+ tags | `ac2_3_create_button_icon_only` | Step Group 7 |
| AC2.4 — Live rebuild on 5th tag | `ac2_4_expanded_with_four_tags` | Step Group 8 |
| AC3.1 — Floating "+ New" tooltip | `ac3_1_tooltip_on_new_button` | Step Group 9 |
| AC3.2 — Toolbar create button tooltip | `ac3_2_create_tooltip` | Step Groups 10, 11 |
| AC3.3 — Toolbar manage button tooltip | `ac3_3_manage_tooltip` | Step Groups 10, 11 |
| AC3.4 — Tooltips at all tag counts | `ac3_2` + `ac3_3` at 0 and 5+ | Step Groups 10, 11 |
