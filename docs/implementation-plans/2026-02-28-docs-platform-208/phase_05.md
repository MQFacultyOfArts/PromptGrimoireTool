# Documentation Platform Implementation Plan — Phase 5

**Goal:** Add MkDocs Material and configure the HTML documentation site, plus integrate Pandoc PDF generation into the pipeline.

**Architecture:** MkDocs Material renders guide markdown and screenshots into an HTML site at `docs/guides/site/`. Pandoc (already in the pipeline) generates PDFs. Both steps are added to `make_docs()` after guide generation completes.

**Tech Stack:** Python 3.14, MkDocs Material, Pandoc

**Scope:** 6 phases from original design (phase 5 of 6)

**Codebase verified:** 2026-02-28

---

## Acceptance Criteria Coverage

This phase implements and tests:

### docs-platform-208.AC6: MkDocs Material renders HTML site
- **docs-platform-208.AC6.1 Success:** `mkdocs build` produces an HTML site in `docs/guides/site/` with landing page, both guides, and embedded screenshots
- **docs-platform-208.AC6.2 Success:** Navigation between landing page and individual guides works
- **docs-platform-208.AC6.3 Success:** `mkdocs serve` starts a local preview server for development

### docs-platform-208.AC7: PDF export via Pandoc
- **docs-platform-208.AC7.1 Success:** Pandoc produces a PDF for each guide with embedded screenshots
- **docs-platform-208.AC7.2 Failure:** Missing `--resource-path` causes image resolution failure (design requires it)

### docs-platform-208.AC9: Zensical migration compatibility
- **docs-platform-208.AC9.1 Success:** `mkdocs.yml` uses standard MkDocs Material configuration with no plugins that would prevent Zensical migration

---

<!-- START_TASK_1 -->
### Task 1: Add mkdocs-material dev dependency

**Files:**
- Modify: `pyproject.toml` (dev dependencies section)

**Step 1: Add mkdocs-material to dev dependencies**

In `pyproject.toml`, add `"mkdocs-material>=9.7"` to the `[dependency-groups] dev` list.

**Step 2: Verify operationally**

Run: `uv sync`
Expected: Dependencies install without errors, mkdocs-material is resolved.

Run: `uv run mkdocs --version`
Expected: Prints mkdocs version information

**Step 3: Commit**

```bash
git add pyproject.toml uv.lock
git commit -m "deps: add mkdocs-material for documentation site generation"
```
<!-- END_TASK_1 -->

<!-- START_TASK_2 -->
### Task 2: Create mkdocs.yml and landing page

**Verifies:** docs-platform-208.AC6.1, docs-platform-208.AC6.2, docs-platform-208.AC9.1

**Files:**
- Create: `mkdocs.yml` (project root)
- Create: `docs/guides/index.md`

**Implementation:**

Create `mkdocs.yml` at the project root with:
- `site_name`: "PromptGrimoire Guides"
- `theme.name`: "material"
- `docs_dir`: "docs/guides"
- `site_dir`: "docs/guides/site"
- `nav`: Landing page + both guide pages
- No plugins beyond MkDocs Material defaults (AC9.1 — Zensical compatible)

```yaml
site_name: PromptGrimoire Guides
theme:
  name: material
docs_dir: docs/guides
site_dir: docs/guides/site
nav:
  - Home: index.md
  - Instructor Setup: instructor-setup.md
  - Student Workflow: student-workflow.md
```

Create `docs/guides/index.md` as a hand-written landing page:
- Project name and brief description
- Links to both guides
- Keep it concise — this is a checked-in file (not generated)

Note: `docs/guides/index.md` must NOT be in `.gitignore` patterns. Currently `.gitignore` has `docs/guides/*.md` which would exclude it. The `.gitignore` entry needs to be made more specific (e.g., only ignore the generated guide markdown files by name) or `index.md` needs a `!docs/guides/index.md` negation line.

**Step 2: Verify operationally**

Run: `uv run mkdocs build`
Expected: Builds successfully. Output appears in `docs/guides/site/`.

Note: At this point the guide markdown files may not exist yet (they're generated by `make-docs`). The build may warn about missing files. Verify with a minimal test: create temporary stub markdown files, run build, verify output, clean up.

**Step 3: Commit**

```bash
git add mkdocs.yml docs/guides/index.md
git commit -m "feat: add MkDocs Material configuration and landing page"
```
<!-- END_TASK_2 -->

<!-- START_TASK_3 -->
### Task 3: Add docs/guides/site/ to .gitignore

**Files:**
- Modify: `.gitignore`

**Step 1: Add site directory to gitignore**

Add `docs/guides/site/` to the documentation artefacts section in `.gitignore` (around lines 44-48).

Also fix the `docs/guides/*.md` pattern to preserve the hand-written `index.md`. Replace the glob with explicit filenames for generated files only:
```
docs/guides/instructor-setup.md
docs/guides/student-workflow.md
```
Remove the old `docs/guides/*.md` glob line.

**Step 2: Verify**

Run: `git status`
Expected: `docs/guides/site/` directory (if it exists from a build) is not shown as untracked.

**Step 3: Commit**

```bash
git add .gitignore
git commit -m "chore: add docs/guides/site/ to gitignore, preserve index.md"
```
<!-- END_TASK_3 -->

<!-- START_SUBCOMPONENT_A (tasks 4-5) -->
<!-- START_TASK_4 -->
### Task 4: Add mkdocs build and Pandoc PDF steps to make_docs()

**Verifies:** docs-platform-208.AC6.1, docs-platform-208.AC7.1, docs-platform-208.AC7.2

**Files:**
- Modify: `src/promptgrimoire/cli.py` (the `make_docs()` function)
- Test: `tests/unit/test_make_docs.py` (unit — add/update tests)

**Implementation:**

After the guide functions have run and before cleanup, add two steps to `make_docs()`:

1. **MkDocs build:** Run `subprocess.run(["uv", "run", "mkdocs", "build"], cwd=project_root, check=True)`. This produces the HTML site in `docs/guides/site/`.

2. **Pandoc PDF generation:** The current Pandoc invocation (lines 2674-2688) already works correctly. Keep the existing pattern:
   - For each guide markdown file, call Pandoc with `--pdf-engine=lualatex` and `--resource-path={md_dir}`
   - The `--resource-path` is critical (AC7.2): without it, Pandoc cannot resolve image references in the markdown

The order should be:
1. Run guide functions (Playwright)
2. `mkdocs build` (HTML site)
3. Pandoc for each guide (PDFs)
4. Cleanup

**Testing:**

Tests must verify:
- docs-platform-208.AC6.1: Mock `subprocess.run` and verify `mkdocs build` is called after guide functions complete
- docs-platform-208.AC7.1: Verify Pandoc is called for each guide with correct arguments (mock subprocess.run)
- docs-platform-208.AC7.2: Verify `--resource-path` is included in Pandoc call args

Update `tests/unit/test_make_docs.py` to add assertions for the mkdocs build step and verify the ordering: guides -> mkdocs build -> pandoc PDFs -> cleanup.

**Verification:**

Run: `uv run pytest tests/unit/test_make_docs.py -v`
Expected: All tests pass

**Commit:** `feat: add mkdocs build and Pandoc PDF steps to make_docs() pipeline`
<!-- END_TASK_4 -->

<!-- START_TASK_5 -->
### Task 5: Verify full pipeline with HTML site and PDFs

**Files:** None (verification only)

**Step 1: Run make-docs**

Run: `uv run make-docs`
Expected: Full pipeline: guides -> mkdocs build -> Pandoc PDFs -> cleanup

**Step 2: Verify HTML site**

Verify:
- `docs/guides/site/` directory exists
- `docs/guides/site/index.html` exists (landing page)
- `docs/guides/site/instructor-setup/index.html` exists
- `docs/guides/site/student-workflow/index.html` exists
- Screenshots are embedded in the HTML pages

**Step 3: Verify PDFs**

Verify:
- `docs/guides/instructor-setup.pdf` exists
- `docs/guides/student-workflow.pdf` exists
- PDFs contain embedded screenshots (not broken image references)

**Step 4: Verify mkdocs serve**

Run: `uv run mkdocs serve` (manually, in separate terminal)
Expected: Local preview server starts at `http://localhost:8000`. Navigation between pages works. (AC6.3)

**Step 5: Run tests**

Run: `uv run test-all`
Expected: All tests pass

Run: `uv run ruff check .`
Expected: No lint errors

Run: `uvx ty check`
Expected: No type errors
<!-- END_TASK_5 -->
<!-- END_SUBCOMPONENT_A -->
